{% load static %}

<div class="comment-thread" style="margin-left: {% if comment.parent %}30px{% else %}0{% endif %};">
    <div class="comment-card mb-3" style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 12px;">
        <div class="d-flex align-items-start">
            <div style="width: 35px; height: 35px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                <span style="color: white; font-weight: 600;">{{ comment.author.username|first|upper }}</span>
            </div>
            <div class="flex-grow-1">
                <div class="d-flex align-items-center flex-wrap gap-2 mb-1">
                    <strong style="font-size: 0.9rem;">{{ comment.author.username }}</strong>
                    {% if comment.author.activity.university %}
                        <span class="uni-badge uni-{{ comment.author.activity.university }}" style="font-size: 0.7rem; padding: 2px 8px;">
                            {% if comment.author.activity.university == 'ub' %}UB{% endif %}
                            {% if comment.author.activity.university == 'buan' %}BUAN{% endif %}
                            {% if comment.author.activity.university == 'botho' %}BOTHO{% endif %}
                            {% if comment.author.activity.university == 'limkokwing' %}LIMKO{% endif %}
                            {% if comment.author.activity.university == 'baisago' %}ISAGO{% endif %}
                            {% if comment.author.activity.university == 'biust' %}BIUST{% endif %}
                        </span>
                    {% endif %}
                    <span class="text-muted" style="font-size: 0.75rem;">{{ comment.created_at|timesince }} ago</span>
                </div>
                <p style="margin-bottom: 5px;">{{ comment.content }}</p>
                
                <!-- Comment actions -->
                <div class="d-flex align-items-center gap-3 mt-2">
                    <!-- Reaction buttons for comment -->
                    <div class="d-flex gap-2">
                        <form method="post" action="{% url 'react_to_comment' comment.id %}" class="d-inline" onclick="event.stopPropagation();">
                            {% csrf_token %}
                            <input type="hidden" name="reaction_type" value="like">
                            <button type="submit" class="btn btn-sm p-0" style="background: none; border: none; color: #666;">
                                üëç <span class="small">{{ comment.commentreaction_set.count }}</span>
                            </button>
                        </form>
                    </div>
                    
                    <!-- Reply button -->
                    <button class="btn btn-sm p-0" onclick="showReplyForm({{ comment.id }})" style="color: var(--neon-purple); background: none; border: none;">
                        Reply
                    </button>
                    
                    <!-- View replies (if any) -->
                    {% if comment.reply_count > 0 %}
                        <button class="btn btn-sm p-0" onclick="toggleReplies({{ comment.id }})" style="color: var(--neon-purple); background: none; border: none;">
                            View {{ comment.reply_count }} repl{{ comment.reply_count|pluralize:"y,ies" }}
                        </button>
                    {% endif %}
                </div>
                
                <!-- Reply form (hidden by default) -->
                <div id="reply-form-{{ comment.id }}" style="display: none; margin-top: 10px;">
                    <form method="post" action="{% url 'reply_to_comment' comment.id %}">
                        {% csrf_token %}
                        <div class="input-group">
                            <input type="text" name="content" class="form-control form-control-sm" placeholder="Write a reply..." required style="border-radius: 20px 0 0 20px;">
                            <button type="submit" class="btn btn-sm btn-create" style="border-radius: 0 20px 20px 0;">Reply</button>
                        </div>
                    </form>
                </div>
                
                <!-- Replies container (hidden by default) -->
                <div id="replies-{{ comment.id }}" style="display: none; margin-top: 15px;">
                    {% for reply in comment.replies.all %}
                        {% include 'posts/comment_thread.html' with comment=reply %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function showReplyForm(commentId) {
    document.getElementById(`reply-form-${commentId}`).style.display = 'block';
}

function toggleReplies(commentId) {
    const repliesDiv = document.getElementById(`replies-${commentId}`);
    if (repliesDiv.style.display === 'none') {
        repliesDiv.style.display = 'block';
    } else {
        repliesDiv.style.display = 'none';
    }
}
</script>