<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Optional Confetti Effect (uncomment if you want it) -->
<!-- <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1"></script>
<script>
    window.onload = function() {
        confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 },
            colors: ['#667eea', '#764ba2', '#ff6b6b', '#ffd700']
        });
    };
</script> -->

<script>
    // Use wss:// for HTTPS, ws:// for HTTP
    const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
    const wsUrl = wsProtocol + '//' + window.location.host + '/ws/online/';
    console.log('ðŸ”Œ Connecting to WebSocket:', wsUrl);
    
    const onlineSocket = new WebSocket(wsUrl);
    
    onlineSocket.onopen = function() {
        console.log('âœ… Online WebSocket connected successfully');
        document.getElementById('online-counter').style.backgroundColor = '#00b09b';
    };
    
    onlineSocket.onmessage = function(e) {
        console.log('ðŸ“¨ WebSocket message received:', e.data);
        try {
            const data = JSON.parse(e.data);
            if (data.type === 'online_count') {
                document.getElementById('online-count').textContent = data.count;
            }
        } catch (error) {
            console.error('Error parsing message:', error);
        }
    };
    
    onlineSocket.onerror = function(e) {
        console.error('âŒ WebSocket error:', e);
        document.getElementById('online-counter').style.backgroundColor = '#ff6b6b';
    };
    
    onlineSocket.onclose = function(e) {
        console.log('ðŸ”Œ WebSocket closed:', e.code, e.reason);
        // Try to reconnect after 5 seconds
        setTimeout(() => {
            console.log('Attempting to reconnect...');
            location.reload();
        }, 5000);
    };
    
    setInterval(() => {
        if (onlineSocket.readyState === WebSocket.OPEN) {
            onlineSocket.send(JSON.stringify({'type': 'ping'}));
            console.log('ðŸ“¤ Ping sent');
        }
    }, 30000);
</script>